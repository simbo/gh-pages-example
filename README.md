gh-pages-example
================

  > Example project for creating and maintaining github pages

---

<!-- TOC -->

- [About this project](#about-this-project)
- [TL;DR](#tldr)
- [Assumed preconditions](#assumed-preconditions)
- [Configure repository and GitHub](#configure-repository-and-github)
- [Managing updates](#managing-updates)
  - […manually (not recommended)](#manually-not-recommended)
  - […automatically using Travis CI](#automatically-using-travis-ci)

<!-- /TOC -->

---


## About this project

This example project demonstrates a clean and convenient strategy to create and
maintain a GitHub pages project.

Generated contents should be kept separated from sources and you should not have
to push them manually, as you already pushed the source changes.

Although changes should be build and published automatically on updates.

There should also be no unusual commandline workflow like submodules or subtree
involved.


## TL;DR

  - add generated contents to `.gitignore` in your `master` branch

  - create an empty/orphan branch `gh-pages` for generated contents

  - setup Travis CI to build from `master` and push build to `gh-pages`


## Assumed preconditions

You have just created your new website project and your project root looks
something like this:

```
./
├─ dist/          # generated contents
├─ src/           # sources and templates
├─ .gitignore     # `dist` folder is ignored
├─ package.json   # project metadata and tasks
└─ README.md      # project information
```


## Configure repository and GitHub

``` sh
# initialize git
git init

# go to github, create the remote repository and add it locally
git remote add origin git@github.com:simbo/gh-pages-example.git

# commit everything (except the `dist` folder, which is added to `.gitignore`)
git add src .gitignore package.json README.md
git commit -m "initial commit"

# push master to github
git push origin master

# create a new orphan branch `gh-pages` and clear the working tree
git checkout --orphan gh-pages
git rm -rf .

# create an `index.html` and add it to git
echo "Hello World" > index.html
git add index.html
git commit -m "initial content"

# push `gh-pages` branch to github
git push origin gh-pages

# switch back to master branch
git checkout master
```

Go to repository settings on GitHub and check the *GitHub Pages* section.

Your branch `gh-pages` should be used as source and your content should then be
published at an URL like this:
[simbo.github.io/gh-pages-example](https://simbo.github.io/gh-pages-example/)

![GitHub Pages Settings Example](./gh-pages-settings.png)


## Managing updates


### …manually (not recommended)

You could simply clone the branch `gh-pages` to the `dist` folder within your
`master` branch.

``` sh
git clone git@github.com:simbo/gh-pages-example.git --branch gh-pages --single-branch dist
```

Now everytime new contents are generated by the build script, you could publish
them by committing them to the `gh-pages` branch:

``` sh
npm run build
cd dist
git add *
git commit -m "update content"
git push origin gh-pages
```

As simply as it seems, this manual method is error-prone as two repos are more
complex to manage manually.


### …automatically using Travis CI

If not done already, register at [Travis CI](https://travis-ci.org/) and install
the [travis client](https://github.com/travis-ci/travis.rb).

Enable travis support for your project using `travis init` and when asked for
main language, choose what fits your project (here we use `node`).

Now there should be a fresh generated `.travis.yml` in your project root.

Go to GitHub and get a [personal access token](https://github.com/settings/tokens).
Give it a useful description like `travis push-back` and select `public_repo` as
access scope.

After generating the token, add it encrypted to your travis config:

``` sh
travis encrypt GITHUB_TOKEN=your-personal-access-token --add
```

Now add deploy settings to your travis config using the
[GitHub Pages provider](https://docs.travis-ci.com/user/deployment/pages/).

Your `.travis.yml` should now look something like this:

``` yaml
language: node_js
node_js:
- '8.11.*'
env:
  global:
    secure: PDS4pIbrZhQaBMAHiLAiHSTwhsiKH...
before_deploy:
- npm run build
deploy:
  provider: pages
  github-token: $GITHUB_TOKEN
  local-dir: dist
  on:
    branch: master
  skip-cleanup: true
  keep-history: true
```

Notice how `local-dir` points to our generated contents folder `dist`.

Every pushed commit to master should now automatically trigger a build and push
updates to gh-pages which will be published at the respective URL.

You're done.

**Happy automated publishing!**
